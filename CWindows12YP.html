<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CWindows12äº‘ç›˜ - å®‰å…¨ä¸ªäººäº‘å­˜å‚¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --gray: #6c757d;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .card-body {
            padding: 30px;
        }
        
        .auth-container {
            display: flex;
            gap: 20px;
        }
        
        .auth-form {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-weight: 600;
            color: var(--dark);
        }
        
        input {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
        }
        
        input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            display: inline-block;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a0a95;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .dashboard {
            display: none;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .file-actions {
            display: flex;
            gap: 10px;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .file-list {
            padding: 20px;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: var(--transition);
        }
        
        .file-item:hover {
            background: #f9f9f9;
        }
        
        .file-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            border-radius: 6px;
            background: #e9ecef;
            color: var(--gray);
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .file-meta {
            font-size: 14px;
            color: var(--gray);
        }
        
        .file-actions-item {
            display: flex;
            gap: 10px;
        }
        
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            margin: 20px;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }
        
        .upload-icon {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .auth-container {
                flex-direction: column;
            }
            
            .dashboard-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .file-actions {
                flex-wrap: wrap;
            }
        }
        
        .security-info {
            background: #e7f3ff;
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 20px;
            border-radius: 4px;
        }
        
        .security-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary);
        }
        
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }
        
        .folder-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: var(--transition);
        }
        
        .folder-item:hover {
            background: #f9f9f9;
        }
        
        .folder-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            border-radius: 6px;
            background: #fff3cd;
            color: #856404;
        }
        
        .folder-info {
            flex: 1;
        }
        
        .folder-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .folder-meta {
            font-size: 14px;
            color: var(--gray);
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
            color: var(--gray);
            cursor: pointer;
        }
        
        .breadcrumb-item:hover {
            color: var(--primary);
        }
        
        .breadcrumb-separator {
            margin: 0 10px;
            color: var(--gray);
        }
        
        .current-folder {
            font-weight: 600;
            color: var(--dark);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1100;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left: 4px solid var(--success);
        }
        
        .notification.error {
            border-left: 4px solid var(--danger);
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç™»å½•/æ³¨å†Œå¡ç‰‡ -->
        <div class="card" id="auth-card">
            <div class="card-header">
                <h1>æ¬¢è¿ä½¿ç”¨CWindows12äº‘ç›˜</h1>
                <p>å®‰å…¨ã€å¯é çš„ä¸ªäººäº‘å­˜å‚¨è§£å†³æ–¹æ¡ˆ</p>
          </div>
            <div class="card-body">
                <div class="auth-container">
                    <!-- ç™»å½•è¡¨å• -->
                    <div class="auth-form">
                        <h2>ç™»å½•è´¦æˆ·</h2>
                        <div class="form-group">
                            <label for="login-email">é‚®ç®±</label>
                          <input type="email" id="login-email" placeholder="è¯·è¾“å…¥æ‚¨çš„é‚®ç®±">
                      </div>
                        <div class="form-group">
                            <label for="login-password">å¯†ç </label>
                            <input type="password" id="login-password" placeholder="è¯·è¾“å…¥å¯†ç ">
                        </div>
                        <button class="btn btn-primary" id="login-btn">ç™»å½•</button>
                        <div class="security-info">
                            <div class="security-title">å®‰å…¨æç¤º</div>
                            <p>æˆ‘ä»¬ä½¿ç”¨ç«¯åˆ°ç«¯åŠ å¯†ä¿æŠ¤æ‚¨çš„æ•°æ®ï¼Œæ‚¨çš„å¯†ç ä¸ä¼šä»¥æ˜æ–‡å½¢å¼å­˜å‚¨ã€‚</p>
                        </div>
                    </div>
                    
                    <!-- æ³¨å†Œè¡¨å• -->
                    <div class="auth-form">
                        <h2>æ³¨å†Œè´¦æˆ·</h2>
                        <div class="form-group">
                            <label for="register-email">é‚®ç®±</label>
                          <input type="email" id="register-email" placeholder="è¯·è¾“å…¥æ‚¨çš„é‚®ç®±">
                      </div>
                        <div class="form-group">
                            <label for="register-password">å¯†ç </label>
                            <input type="password" id="register-password" placeholder="è¯·è®¾ç½®å¯†ç ï¼ˆè‡³å°‘8ä½ï¼‰">
                        </div>
                        <div class="form-group">
                            <label for="confirm-password">ç¡®è®¤å¯†ç </label>
                            <input type="password" id="confirm-password" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                        </div>
                        <button class="btn btn-secondary" id="register-btn">æ³¨å†Œ</button>
                      <div class="security-info">
                            <div class="security-title">äº‘ç›˜é›†æˆ</div>
                          <p>æ³¨å†Œåï¼Œæ‚¨çš„æ–‡ä»¶å°†å®‰å…¨å­˜å‚¨åœ¨CWindows12äº‘ç›˜ä¸­ï¼Œéšæ—¶éšåœ°è®¿é—®ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- äº‘ç›˜ç•Œé¢ -->
        <div class="card dashboard" id="dashboard">
            <div class="dashboard-header">
                <h2>æˆ‘çš„äº‘ç›˜</h2>
                <div class="user-info">
                    <div class="avatar" id="user-avatar">U</div>
                    <div>
                        <div id="user-email">user@example.com</div>
                        <button class="btn btn-outline" id="logout-btn">é€€å‡ºç™»å½•</button>
                    </div>
                </div>
            </div>
            
            <div class="breadcrumb" id="breadcrumb">
                <div class="breadcrumb-item current-folder">å…¨éƒ¨æ–‡ä»¶</div>
            </div>
            
            <div class="file-actions">
                <button class="btn btn-primary" id="upload-btn">
                    <i class="fas fa-upload"></i> ä¸Šä¼ æ–‡ä»¶
                </button>
                <button class="btn btn-success" id="new-folder-btn">
                    <i class="fas fa-folder-plus"></i> æ–°å»ºæ–‡ä»¶å¤¹
                </button>
                <button class="btn btn-outline" id="refresh-btn">
                    <i class="fas fa-sync-alt"></i> åˆ·æ–°
                </button>
                <input type="file" id="file-input" class="hidden" multiple>
            </div>
            
            <div class="upload-area" id="upload-area">
                <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                <h3>æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </h3>
                <p>æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
            </div>
            
            <div class="file-list">
                <h3 id="current-folder-title">å…¨éƒ¨æ–‡ä»¶</h3>
                <div id="files-container">
                    <div class="loader" id="files-loader"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°å»ºæ–‡ä»¶å¤¹æ¨¡æ€æ¡† -->
    <div class="modal" id="folder-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ–°å»ºæ–‡ä»¶å¤¹</h3>
                <button class="close-btn" id="close-folder-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="folder-name">æ–‡ä»¶å¤¹åç§°</label>
                <input type="text" id="folder-name" placeholder="è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°">
            </div>
            <button class="btn btn-primary" id="create-folder-btn">åˆ›å»º</button>
        </div>
    </div>

    <!-- é€šçŸ¥ -->
    <div class="notification hidden" id="notification">
        <i class="fas fa-check-circle" id="notification-icon"></i>
        <span id="notification-text"></span>
    </div>

    <script>
        // æ¨¡æ‹ŸæœåŠ¡å™¨å­˜å‚¨
        class CloudStorageServer {
            constructor() {
                this.users = JSON.parse(localStorage.getItem('cloud_drive_users')) || {};
                this.fileStorage = JSON.parse(localStorage.getItem('cloud_drive_files')) || {};
            }
            
            // ç”¨æˆ·è®¤è¯
            registerUser(email, password) {
                if (this.users[email]) {
                    throw new Error('ç”¨æˆ·å·²å­˜åœ¨');
                }
                this.users[email] = {
                    password: password,
                    files: [],
                    folders: []
                };
                this.saveUsers();
            }
            
            loginUser(email, password) {
                if (!this.users[email] || this.users[email].password !== password) {
                    throw new Error('é‚®ç®±æˆ–å¯†ç é”™è¯¯');
                }
                return this.users[email];
            }
            
            // æ–‡ä»¶æ“ä½œ
            uploadFile(email, file, fileData) {
                const user = this.users[email];
                if (!user) throw new Error('ç”¨æˆ·ä¸å­˜åœ¨');
                
                // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨
                if (user.files.some(f => f.name === file.name)) {
                    throw new Error('æ–‡ä»¶å·²å­˜åœ¨');
                }
                
                // å­˜å‚¨æ–‡ä»¶å…ƒæ•°æ®
                const fileMeta = {
                    id: this.generateFileId(),
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    uploaded: new Date().toISOString(),
                    owner: email
                };
                
                user.files.push(fileMeta);
                
                // å­˜å‚¨æ–‡ä»¶å†…å®¹
                this.fileStorage[fileMeta.id] = {
                    data: fileData,
                    meta: fileMeta
                };
                
                this.saveUsers();
                this.saveFiles();
                
                return fileMeta;
            }
            
            downloadFile(email, filename) {
                const user = this.users[email];
                if (!user) throw new Error('ç”¨æˆ·ä¸å­˜åœ¨');
                
                const fileMeta = user.files.find(f => f.name === filename);
                if (!fileMeta) throw new Error('æ–‡ä»¶ä¸å­˜åœ¨');
                
                const fileData = this.fileStorage[fileMeta.id];
                if (!fileData) throw new Error('æ–‡ä»¶æ•°æ®ä¸¢å¤±');
                
                return {
                    data: fileData.data,
                    meta: fileMeta
                };
            }
            
            deleteFile(email, filename) {
                const user = this.users[email];
                if (!user) throw new Error('ç”¨æˆ·ä¸å­˜åœ¨');
                
                const fileIndex = user.files.findIndex(f => f.name === filename);
                if (fileIndex === -1) throw new Error('æ–‡ä»¶ä¸å­˜åœ¨');
                
                const fileMeta = user.files[fileIndex];
                delete this.fileStorage[fileMeta.id];
                user.files.splice(fileIndex, 1);
                
                this.saveUsers();
                this.saveFiles();
            }
            
            // æ–‡ä»¶å¤¹æ“ä½œ
            createFolder(email, folderName) {

                const user = this.users[email];
                if (!user) throw new Error('ç”¨æˆ·ä¸å­˜åœ¨');
                
                if (user.folders.some(f => f.name === folderName)) {
                    throw new Error('æ–‡ä»¶å¤¹å·²å­˜åœ¨');
                }
                
                user.folders.push({
                    name: folderName,
                    created: new Date().toISOString()
                });
                
                this.saveUsers();
            }
            
            deleteFolder(email, folderName) {
                const user = this.users[email];
                if (!user) throw new Error('ç”¨æˆ·ä¸å­˜åœ¨');
                
                const folderIndex = user.folders.findIndex(f => f.name === folderName);
                if (folderIndex === -1) throw new Error('æ–‡ä»¶å¤¹ä¸å­˜åœ¨');
                
                user.folders.splice(folderIndex, 1);
                this.saveUsers();
            }
            
            // è¾…åŠ©æ–¹æ³•
            generateFileId() {
                return 'file_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            saveUsers() {
                localStorage.setItem('cloud_drive_users', JSON.stringify(this.users));
            }
            
            saveFiles() {
                localStorage.setItem('cloud_drive_files', JSON.stringify(this.fileStorage));
            }
            
            getUserFiles(email) {
                const user = this.users[email];
                return user ? user.files : [];
            }
            
            getUserFolders(email) {
                const user = this.users[email];
                return user ? user.folders : [];
            }
        }

        // åˆå§‹åŒ–æœåŠ¡å™¨
        const cloudServer = new CloudStorageServer();
        
        // DOMå…ƒç´ 
        const authCard = document.getElementById('auth-card');
        const dashboard = document.getElementById('dashboard');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const uploadBtn = document.getElementById('upload-btn');
        const newFolderBtn = document.getElementById('new-folder-btn');
        const refreshBtn = document.getElementById('refresh-btn');
        const fileInput = document.getElementById('file-input');
        const uploadArea = document.getElementById('upload-area');
        const filesContainer = document.getElementById('files-container');
        const userEmail = document.getElementById('user-email');
        const userAvatar = document.getElementById('user-avatar');
        const folderModal = document.getElementById('folder-modal');
        const closeFolderModal = document.getElementById('close-folder-modal');
        const createFolderBtn = document.getElementById('create-folder-btn');
        const folderNameInput = document.getElementById('folder-name');
        const breadcrumb = document.getElementById('breadcrumb');
        const currentFolderTitle = document.getElementById('current-folder-title');
        const notification = document.getElementById('notification');
        const notificationIcon = document.getElementById('notification-icon');
        const notificationText = document.getElementById('notification-text');
        
        // å½“å‰æ–‡ä»¶å¤¹è·¯å¾„
        let currentPath = [];
        let currentUserEmail = null;
        
        // åˆå§‹åŒ– - ç¡®ä¿æ˜¾ç¤ºç™»å½•é¡µé¢
        showAuth();
        
        // ç™»å½•äº‹ä»¶
        loginBtn.addEventListener('click', () => {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showNotification('è¯·å¡«å†™é‚®ç®±å’Œå¯†ç ', 'error');
                return;
            }
            
            try {
                cloudServer.loginUser(email, password);
                currentUserEmail = email;
                localStorage.setItem('cloud_drive_current_user', email);
                showDashboard(email);
                showNotification('ç™»å½•æˆåŠŸ', 'success');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        });
        
        // æ³¨å†Œäº‹ä»¶
        registerBtn.addEventListener('click', () => {
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (!email || !password || !confirmPassword) {
                showNotification('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'error');
                return;
            }
            
            if (password.length < 8) {
                showNotification('å¯†ç é•¿åº¦è‡³å°‘8ä½', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
                return;
            }
            
            try {
                cloudServer.registerUser(email, password);
                showNotification('æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•', 'success');
                
                document.getElementById('register-email').value = '';
                document.getElementById('register-password').value = '';
                document.getElementById('confirm-password').value = '';
            } catch (error) {
                showNotification(error.message, 'error');
            }
        });
        
        // é€€å‡ºç™»å½•
        logoutBtn.addEventListener('click', () => {
            currentUserEmail = null;
            localStorage.removeItem('cloud_drive_current_user');
            showAuth();
            showNotification('å·²é€€å‡ºç™»å½•', 'success');
        });
        
        // ä¸Šä¼ æ–‡ä»¶
        uploadBtn.addEventListener('click', () => {
            fileInput.click();
        });
        
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', async (e) => {
            const files = e.target.files;
            if (files.length > 0) {
                await uploadFiles(files);
            }
        });
        
        // æ‹–æ”¾ä¸Šä¼ 
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--primary)';
            uploadArea.style.background = 'rgba(67, 97, 238, 0.1)';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#ddd';
            uploadArea.style.background = '';
        });
        
        uploadArea.addEventListener('drop', async (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ddd';
            uploadArea.style.background = '';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                await uploadFiles(files);
            }
        });
        
        // æ–°å»ºæ–‡ä»¶å¤¹
        newFolderBtn.addEventListener('click', () => {
            folderModal.style.display = 'flex';
            folderNameInput.value = '';
            folderNameInput.focus();
        });
        
        closeFolderModal.addEventListener('click', () => {
            folderModal.style.display = 'none';
        });
        
        createFolderBtn.addEventListener('click', () => {
            const folderName = folderNameInput.value.trim();
            if (!folderName) {
                showNotification('è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°', 'error');
                return;
            }
            
            try {
                cloudServer.createFolder(currentUserEmail, folderName);
                folderModal.style.display = 'none';
                loadFiles(currentUserEmail);
                showNotification(`æ–‡ä»¶å¤¹ "${folderName}" åˆ›å»ºæˆåŠŸ`, 'success');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        });
        
        // åˆ·æ–°æ–‡ä»¶åˆ—è¡¨
        refreshBtn.addEventListener('click', () => {
            if (currentUserEmail) {
                loadFiles(currentUserEmail);
                showNotification('æ–‡ä»¶åˆ—è¡¨å·²åˆ·æ–°', 'success');
            }
        });
        
        // æ˜¾ç¤ºäº‘ç›˜ç•Œé¢
        function showDashboard(email) {
            authCard.style.display = 'none';
            dashboard.style.display = 'block';
            userEmail.textContent = email;
            userAvatar.textContent = email.charAt(0).toUpperCase();
            
            currentPath = [];
            updateBreadcrumb();
            loadFiles(email);
        }
        
        // æ˜¾ç¤ºç™»å½•ç•Œé¢
        function showAuth() {
            authCard.style.display = 'block';
            dashboard.style.display = 'none';
            
            document.getElementById('login-email').value = '';
            document.getElementById('login-password').value = '';
        }
        
        // åŠ è½½æ–‡ä»¶åˆ—è¡¨
        function loadFiles(email) {
            filesContainer.innerHTML = '<div class="loader" id="files-loader"></div>';
            
            setTimeout(() => {
                try {
                    const userFiles = cloudServer.getUserFiles(email);
                    const userFolders = cloudServer.getUserFolders(email);
                    
                    if (userFiles.length === 0 && userFolders.length === 0) {
                        filesContainer.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: var(--gray);">
                                <div style="font-size: 48px; margin-bottom: 15px;"><i class="fas fa-folder-open"></i></div>
                                <h3>æš‚æ— æ–‡ä»¶</h3>
                                <p>ä¸Šä¼ æ‚¨çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶å¼€å§‹ä½¿ç”¨äº‘ç›˜</p>
                            </div>
                        `;
                        return;
                    }
                    
                    let filesHTML = '';
                    
                    // æ˜¾ç¤ºæ–‡ä»¶å¤¹
                    userFolders.forEach(folder => {
                        filesHTML += `
                            <div class="folder-item" onclick="openFolder('${folder.name}')">
                                <div class="folder-icon"><i class="fas fa-folder"></i></div>
                                <div class="folder-info">
                                    <div class="folder-name">${folder.name}</div>
                                    <div class="folder-meta">æ–‡ä»¶å¤¹ â€¢ åˆ›å»ºäº ${new Date(folder.created).toLocaleDateString()}</div>
                                </div>
                                <div class="file-actions-item">
                                    <button class="btn btn-danger" onclick="event.stopPropagation(); deleteFolder('${folder.name}')">åˆ é™¤</button>
                                </div>
                            </div>
                        `;
                    });
                    
                    // æ˜¾ç¤ºæ–‡ä»¶
                    userFiles.forEach(file => {
                        const fileSize = formatFileSize(file.size);
                        const uploadDate = new Date(file.uploaded).toLocaleDateString();
                        
                        filesHTML += `
                            <div class="file-item">
                                <div class="file-icon">${getFileIcon(file.type)}</div>
                                <div class="file-info">
                                    <div class="file-name">${file.name}</div>
                                    <div class="file-meta">${fileSize} â€¢ ä¸Šä¼ äº ${uploadDate}</div>
                                </div>
                                <div class="file-actions-item">
                                    <button class="btn btn-primary" onclick="downloadFile('${file.name}')">ä¸‹è½½</button>
                                    <button class="btn btn-danger" onclick="deleteFile('${file.name}')">åˆ é™¤</button>
                                </div>
                            </div>
                        `;
                    });
                    
                    filesContainer.innerHTML = filesHTML;
                } catch (error) {
                    showNotification('åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥: ' + error.message, 'error');
                }
            }, 1000);
        }
        
        // ä¸Šä¼ æ–‡ä»¶
        async function uploadFiles(files) {
            if (!currentUserEmail) return;
            
            filesContainer.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div class="loader"></div>
                    <p>ä¸Šä¼ æ–‡ä»¶ä¸­...</p>
                </div>
            `;
            
            try {
                let successCount = 0;
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    
                    // è¯»å–æ–‡ä»¶å†…å®¹
                    const fileData = await readFileAsArrayBuffer(file);
                    
                    try {
                        cloudServer.uploadFile(currentUserEmail, file, fileData);
                        successCount++;
                    } catch (error) {
                        if (error.message === 'æ–‡ä»¶å·²å­˜åœ¨') {
                            showNotification(`æ–‡ä»¶ "${file.name}" å·²å­˜åœ¨`, 'error');
                        } else {
                            throw error;
                        }
                    }
                }
                
                loadFiles(currentUserEmail);
                showNotification(`æˆåŠŸä¸Šä¼  ${successCount} ä¸ªæ–‡ä»¶`, 'success');
            } catch (error) {
                showNotification('ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // è¯»å–æ–‡ä»¶ä¸ºArrayBuffer
        function readFileAsArrayBuffer(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }
        
        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(filename) {
            if (!currentUserEmail) return;
            
            try {
                const fileData = cloudServer.downloadFile(currentUserEmail, filename);
                
                // åˆ›å»ºBlob
                const blob = new Blob([fileData.data], { type: fileData.meta.type });
                const url = URL.createObjectURL(blob);
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                
                // è§¦å‘ä¸‹è½½
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // æ¸…ç†URL
                setTimeout(() => URL.revokeObjectURL(url), 100);
                
                showNotification(`å¼€å§‹ä¸‹è½½: ${filename}`, 'success');
            } catch (error) {
                showNotification('ä¸‹è½½å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // åˆ é™¤æ–‡ä»¶
        function deleteFile(filename) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤ "${filename}" å—ï¼Ÿ`)) {
                try {
                    cloudServer.deleteFile(currentUserEmail, filename);
                    loadFiles(currentUserEmail);
                    showNotification(`æ–‡ä»¶ "${filename}" å·²åˆ é™¤`, 'success');
                } catch (error) {
                    showNotification('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
                }
            }
        }
        
        // åˆ é™¤æ–‡ä»¶å¤¹
        function deleteFolder(folderName) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶å¤¹ "${folderName}" å—ï¼Ÿ`)) {
                try {
                    cloudServer.deleteFolder(currentUserEmail, folderName);
                    loadFiles(currentUserEmail);
                    showNotification(`æ–‡ä»¶å¤¹ "${folderName}" å·²åˆ é™¤`, 'success');
                } catch (error) {
                    showNotification('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
                }
            }
        }
        
        // æ‰“å¼€æ–‡ä»¶å¤¹
        function openFolder(folderName) {
            currentPath.push(folderName);
            updateBreadcrumb();
            
            filesContainer.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--gray);">
                    <div style="font-size: 48px; margin-bottom: 15px;"><i class="fas fa-folder-open"></i></div>
                    <h3>${folderName}</h3>
                    <p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºæ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶</p>
                    <button class="btn btn-primary" onclick="goBack()" style="margin-top: 15px;">è¿”å›ä¸Šçº§ç›®å½•</button>
                </div>
            `;
        }
        
        // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
        function updateBreadcrumb() {
            let breadcrumbHTML = '';
            
            breadcrumbHTML += `<div class="breadcrumb-item" onclick="goToRoot()">å…¨éƒ¨æ–‡ä»¶</div>`;
            
            currentPath.forEach((folder, index) => {
                breadcrumbHTML += `<div class="breadcrumb-separator">/</div>`;
                if (index === currentPath.length - 1) {
                    breadcrumbHTML += `<div class="breadcrumb-item current-folder">${folder}</div>`;
                } else {
                    breadcrumbHTML += `<div class="breadcrumb-item" onclick="goToFolder(${index})">${folder}</div>`;
                }
            });
            
            breadcrumb.innerHTML = breadcrumbHTML;
            currentFolderTitle.textContent = currentPath.length > 0 ? currentPath[currentPath.length - 1] : 'å…¨éƒ¨æ–‡ä»¶';
        }
        
        // è¿”å›æ ¹ç›®å½•
        function goToRoot() {
            currentPath = [];
            updateBreadcrumb();
            loadFiles(currentUserEmail);
        }
        
        // è¿”å›ä¸Šçº§ç›®å½•
        function goBack() {
            if (currentPath.length > 0) {
                currentPath.pop();
                updateBreadcrumb();
                loadFiles(currentUserEmail);
            }
        }
        
        // è·³è½¬åˆ°æŒ‡å®šæ–‡ä»¶å¤¹
        function goToFolder(index) {
            currentPath = currentPath.slice(0, index + 1);
            updateBreadcrumb();
            loadFiles(currentUserEmail);
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type) {
            notification.className = `notification ${type}`;
            notificationText.textContent = message;
            
            if (type === 'success') {
                notificationIcon.className = 'fas fa-check-circle';
            } else {
                notificationIcon.className = 'fas fa-exclamation-circle';
            }
            
            notification.classList.remove('hidden');
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 300);
            }, 3000);
        }
        
        // å·¥å…·å‡½æ•°ï¼šè·å–æ–‡ä»¶ç±»å‹å›¾æ ‡
        function getFileIcon(fileType) {
            if (fileType.startsWith('image/')) return 'ğŸ–¼ï¸';
            if (fileType.startsWith('video/')) return 'ğŸ¬';
            if (fileType.startsWith('audio/')) return 'ğŸµ';
            if (fileType.includes('pdf')) return 'ğŸ“„';
            if (fileType.includes('zip') || fileType.includes('rar')) return 'ğŸ“¦';
            if (fileType.includes('word') || fileType.includes('document')) return 'ğŸ“';
            if (fileType.includes('sheet') || fileType.includes('excel')) return 'ğŸ“Š';
            return 'ğŸ“„';
        }
        
        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>