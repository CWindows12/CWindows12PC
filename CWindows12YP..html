<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CWindows12äº‘ç›˜ - å®‰å…¨ä¸ªäººäº‘å­˜å‚¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --gray: #6c757d;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .card-body {
            padding: 30px;
        }
        
        /* ç™»å½•/æ³¨å†Œè¡¨å•æ ·å¼ */
        .auth-container {
            display: flex;
            gap: 20px;
        }
        
        .auth-form {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-weight: 600;
            color: var(--dark);
        }
        
        input {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
        }
        
        input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            display: inline-block;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a0a95;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        /* äº‘ç›˜ç•Œé¢æ ·å¼ */
        .dashboard {
            display: none;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .file-actions {
            display: flex;
            gap: 10px;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .file-list {
            padding: 20px;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: var(--transition);
        }
        
        .file-item:hover {
            background: #f9f9f9;
        }
        
        .file-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            border-radius: 6px;
            background: #e9ecef;
            color: var(--gray);
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .file-meta {
            font-size: 14px;
            color: var(--gray);
        }
        
        .file-actions-item {
            display: flex;
            gap: 10px;
        }
        
        /* ä¸Šä¼ åŒºåŸŸæ ·å¼ */
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            margin: 20px;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }
        
        .upload-icon {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .auth-container {
                flex-direction: column;
            }
            
            .dashboard-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .file-actions {
                flex-wrap: wrap;
            }
        }
        
        /* å®‰å…¨æç¤º */
        .security-info {
            background: #e7f3ff;
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 20px;
            border-radius: 4px;
        }
        
        .security-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary);
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }
        
        .folder-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: var(--transition);
        }
        
        .folder-item:hover {
            background: #f9f9f9;
        }
        
        .folder-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            border-radius: 6px;
            background: #fff3cd;
            color: #856404;
        }
        
        .folder-info {
            flex: 1;
        }
        
        .folder-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .folder-meta {
            font-size: 14px;
            color: var(--gray);
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
            color: var(--gray);
            cursor: pointer;
        }
        
        .breadcrumb-item:hover {
            color: var(--primary);
        }
        
        .breadcrumb-separator {
            margin: 0 10px;
            color: var(--gray);
        }
        
        .current-folder {
            font-weight: 600;
            color: var(--dark);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç™»å½•/æ³¨å†Œå¡ç‰‡ -->
        <div class="card" id="auth-card">
            <div class="card-header">
                <h1>æ¬¢è¿ç™»å½•CWindows12äº‘ç›˜</h1>
                <p>å®‰å…¨ã€å¯é çš„ä¸ªäººäº‘å­˜å‚¨è§£å†³æ–¹æ¡ˆ</p>
          </div>
            <div class="card-body">
                <div class="auth-container">
                    <!-- ç™»å½•è¡¨å• -->
                    <div class="auth-form">
                        <h2>ç™»å½•è´¦æˆ·</h2>
                        <div class="form-group">
                            <label for="login-email">é‚®ç®±åœ°å€</label>
                            <input type="email" id="login-email" placeholder="è¯·è¾“å…¥æ‚¨çš„é‚®ç®±">
                        </div>
                        <div class="form-group">
                            <label for="login-password">å¯†ç </label>
                            <input type="password" id="login-password" placeholder="è¯·è¾“å…¥å¯†ç ">
                        </div>
                        <button class="btn btn-primary" id="login-btn">ç™»å½•</button>
                        <div class="security-info">
                            <div class="security-title">å®‰å…¨æç¤º</div>
                            <p>æˆ‘ä»¬ä½¿ç”¨ç«¯åˆ°ç«¯åŠ å¯†ä¿æŠ¤æ‚¨çš„æ•°æ®ï¼Œæ‚¨çš„å¯†ç ä¸ä¼šä»¥æ˜æ–‡å½¢å¼å­˜å‚¨ã€‚</p>
                        </div>
                    </div>
                    
                    <!-- æ³¨å†Œè¡¨å• -->
                    <div class="auth-form">
                        <h2>æ³¨å†Œè´¦æˆ·</h2>
                        <div class="form-group">
                            <label for="register-email">é‚®ç®±åœ°å€</label>
                            <input type="email" id="register-email" placeholder="è¯·è¾“å…¥æ‚¨çš„é‚®ç®±">
                        </div>
                        <div class="form-group">
                            <label for="register-password">å¯†ç </label>
                            <input type="password" id="register-password" placeholder="è¯·è®¾ç½®å¯†ç ï¼ˆè‡³å°‘8ä½ï¼‰">
                        </div>
                        <div class="form-group">
                            <label for="confirm-password">ç¡®è®¤å¯†ç </label>
                            <input type="password" id="confirm-password" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                        </div>
                        <button class="btn btn-secondary" id="register-btn">æ³¨å†Œ</button>
                      <div class="security-info">
                            <div class="security-title">CWindows12äº‘ç›˜é›†æˆ</div>
                          <p>æ³¨å†Œåï¼Œæ‚¨çš„æ–‡ä»¶å°†å®‰å…¨å­˜å‚¨åœ¨CWindows12äº‘ç›˜ä»“åº“ä¸­ï¼Œéšæ—¶éšåœ°è®¿é—®ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- äº‘ç›˜ç•Œé¢ -->
        <div class="card dashboard" id="dashboard">
            <div class="dashboard-header">
                <h2>æˆ‘çš„äº‘ç›˜</h2>
                <div class="user-info">
                    <div class="avatar" id="user-avatar">U</div>
                    <div>
                        <div id="user-email">user@example.com</div>
                        <button class="btn btn-outline" id="logout-btn">é€€å‡ºç™»å½•</button>
                    </div>
                </div>
            </div>
            
            <div class="breadcrumb" id="breadcrumb">
                <div class="breadcrumb-item current-folder">å…¨éƒ¨æ–‡ä»¶</div>
            </div>
            
            <div class="file-actions">
                <button class="btn btn-primary" id="upload-btn">
                    <i class="fas fa-upload"></i> ä¸Šä¼ æ–‡ä»¶
                </button>
                <button class="btn btn-success" id="new-folder-btn">
                    <i class="fas fa-folder-plus"></i> æ–°å»ºæ–‡ä»¶å¤¹
                </button>
                <button class="btn btn-outline" id="refresh-btn">
                    <i class="fas fa-sync-alt"></i> åˆ·æ–°
                </button>
                <input type="file" id="file-input" class="hidden" multiple>
            </div>
            
            <div class="upload-area" id="upload-area">
                <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                <h3>æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </h3>
                <p>æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
            </div>
            
            <div class="file-list">
                <h3 id="current-folder-title">å…¨éƒ¨æ–‡ä»¶</h3>
                <div id="files-container">
                    <!-- æ–‡ä»¶åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    <div class="loader" id="files-loader"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°å»ºæ–‡ä»¶å¤¹æ¨¡æ€æ¡† -->
    <div class="modal" id="folder-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ–°å»ºæ–‡ä»¶å¤¹</h3>
                <button class="close-btn" id="close-folder-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="folder-name">æ–‡ä»¶å¤¹åç§°</label>
                <input type="text" id="folder-name" placeholder="è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°">
            </div>
            <button class="btn btn-primary" id="create-folder-btn">åˆ›å»º</button>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®å­˜å‚¨ï¼ˆå®é™…é¡¹ç›®ä¸­åº”ä½¿ç”¨åç«¯APIï¼‰
        const users = JSON.parse(localStorage.getItem('cloud_drive_users')) || {};
        
        // DOMå…ƒç´ 
        const authCard = document.getElementById('auth-card');
        const dashboard = document.getElementById('dashboard');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const uploadBtn = document.getElementById('upload-btn');
        const newFolderBtn = document.getElementById('new-folder-btn');
        const refreshBtn = document.getElementById('refresh-btn');
        const fileInput = document.getElementById('file-input');
        const uploadArea = document.getElementById('upload-area');
        const filesContainer = document.getElementById('files-container');
        const userEmail = document.getElementById('user-email');
        const userAvatar = document.getElementById('user-avatar');
        const folderModal = document.getElementById('folder-modal');
        const closeFolderModal = document.getElementById('close-folder-modal');
        const createFolderBtn = document.getElementById('create-folder-btn');
        const folderNameInput = document.getElementById('folder-name');
        const breadcrumb = document.getElementById('breadcrumb');
        const currentFolderTitle = document.getElementById('current-folder-title');
        
        // å½“å‰æ–‡ä»¶å¤¹è·¯å¾„
        let currentPath = [];
        
        // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
        const currentUser = localStorage.getItem('cloud_drive_current_user');
        if (currentUser) {
            showDashboard(currentUser);
        }
        
        // ç™»å½•äº‹ä»¶
        loginBtn.addEventListener('click', () => {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                alert('è¯·å¡«å†™é‚®ç®±å’Œå¯†ç ');
                return;
            }
            
            // æ¨¡æ‹Ÿç™»å½•éªŒè¯
            if (users[email] && users[email].password === password) {
                localStorage.setItem('cloud_drive_current_user', email);
                showDashboard(email);
            } else {
                alert('é‚®ç®±æˆ–å¯†ç é”™è¯¯');
            }
        });
        
        // æ³¨å†Œäº‹ä»¶
        registerBtn.addEventListener('click', () => {
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (!email || !password || !confirmPassword) {
                alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }
            
            if (password.length < 8) {
                alert('å¯†ç é•¿åº¦è‡³å°‘8ä½');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                return;
            }
            
            if (users[email]) {
                alert('è¯¥é‚®ç®±å·²æ³¨å†Œ');
                return;
            }
            
            // æ¨¡æ‹Ÿç”¨æˆ·æ³¨å†Œ
            users[email] = {
                password: password,
                files: [],
                folders: []
            };
            
            localStorage.setItem('cloud_drive_users', JSON.stringify(users));
            alert('æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•');
            
            // æ¸…ç©ºæ³¨å†Œè¡¨å•
            document.getElementById('register-email').value = '';
            document.getElementById('register-password').value = '';
            document.getElementById('confirm-password').value = '';
        });
        
        // é€€å‡ºç™»å½•
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('cloud_drive_current_user');
            showAuth();
        });
        
        // ä¸Šä¼ æ–‡ä»¶
        uploadBtn.addEventListener('click', () => {
            fileInput.click();
        });
        
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', (e) => {
            const files = e.target.files;
            if (files.length > 0) {
                uploadFiles(files);
            }
        });
        
        // æ‹–æ”¾ä¸Šä¼ 
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--primary)';
            uploadArea.style.background = 'rgba(67, 97, 238, 0.1)';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#ddd';
            uploadArea.style.background = '';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ddd';
            uploadArea.style.background = '';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                uploadFiles(files);
            }
        });
        
        // æ–°å»ºæ–‡ä»¶å¤¹
        newFolderBtn.addEventListener('click', () => {
            folderModal.style.display = 'flex';
            folderNameInput.value = '';
        });
        
        closeFolderModal.addEventListener('click', () => {
            folderModal.style.display = 'none';
        });
        
        createFolderBtn.addEventListener('click', () => {
            const folderName = folderNameInput.value.trim();
            if (!folderName) {
                alert('è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°');
                return;
            }
            
            createFolder(folderName);
            folderModal.style.display = 'none';
        });
        
        // åˆ·æ–°æ–‡ä»¶åˆ—è¡¨
        refreshBtn.addEventListener('click', () => {
            loadFiles(currentUser);
        });
        
        // æ˜¾ç¤ºäº‘ç›˜ç•Œé¢
        function showDashboard(email) {
            authCard.style.display = 'none';
            dashboard.style.display = 'block';
            userEmail.textContent = email;
            userAvatar.textContent = email.charAt(0).toUpperCase();
            
            // é‡ç½®å½“å‰è·¯å¾„
            currentPath = [];
            updateBreadcrumb();
            
            // åŠ è½½ç”¨æˆ·æ–‡ä»¶
            loadFiles(email);
        }
        
        // æ˜¾ç¤ºç™»å½•ç•Œé¢
        function showAuth() {
            authCard.style.display = 'block';
            dashboard.style.display = 'none';
        }
        
        // åŠ è½½æ–‡ä»¶åˆ—è¡¨
        function loadFiles(email) {
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            filesContainer.innerHTML = '<div class="loader" id="files-loader"></div>';
            
            // æ¨¡æ‹Ÿä»GitHub APIè·å–æ–‡ä»¶
            setTimeout(() => {
                const userData = users[email] || { files: [], folders: [] };
                const userFiles = userData.files || [];
                const userFolders = userData.folders || [];
                
                if (userFiles.length === 0 && userFolders.length === 0) {
                    filesContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--gray);">
                            <div style="font-size: 48px; margin-bottom: 15px;"><i class="fas fa-folder-open"></i></div>
                            <h3>æš‚æ— æ–‡ä»¶</h3>
                            <p>ä¸Šä¼ æ‚¨çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶å¼€å§‹ä½¿ç”¨äº‘ç›˜</p>
                        </div>
                    `;
                    return;
                }
                
                let filesHTML = '';
                
                // æ˜¾ç¤ºæ–‡ä»¶å¤¹
                userFolders.forEach(folder => {
                    filesHTML += `
                        <div class="folder-item" onclick="openFolder('${folder.name}')">
                            <div class="folder-icon"><i class="fas fa-folder"></i></div>
                            <div class="folder-info">
                                <div class="folder-name">${folder.name}</div>
                                <div class="folder-meta">æ–‡ä»¶å¤¹ â€¢ åˆ›å»ºäº ${new Date(folder.created).toLocaleDateString()}</div>
                            </div>
                            <div class="file-actions-item">
                                <button class="btn btn-danger" onclick="event.stopPropagation(); deleteFolder('${folder.name}')">åˆ é™¤</button>
                            </div>
                        </div>
                    `;
                });
                
                // æ˜¾ç¤ºæ–‡ä»¶
                userFiles.forEach(file => {
                    const fileSize = formatFileSize(file.size);
                    const uploadDate = new Date(file.uploaded).toLocaleDateString();
                    
                    filesHTML += `
                        <div class="file-item">
                            <div class="file-icon">${getFileIcon(file.type)}</div>
                            <div class="file-info">
                                <div class="file-name">${file.name}</div>
                                <div class="file-meta">${fileSize} â€¢ ä¸Šä¼ äº ${uploadDate}</div>
                            </div>
                            <div class="file-actions-item">
                                <button class="btn btn-outline" onclick="downloadFile('${file.name}')">ä¸‹è½½</button>
                                <button class="btn btn-danger" onclick="deleteFile('${file.name}')">åˆ é™¤</button>
                            </div>
                        </div>
                    `;
                });
                
                filesContainer.innerHTML = filesHTML;
            }, 1000);
        }
        
        // ä¸Šä¼ æ–‡ä»¶
        function uploadFiles(files) {
            const email = localStorage.getItem('cloud_drive_current_user');
            if (!email) return;
            
            // æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
            filesContainer.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div class="loader"></div>
                    <p>ä¸Šä¼ æ–‡ä»¶ä¸­...</p>
                </div>
            `;
            
            // æ¨¡æ‹Ÿä¸Šä¼ åˆ°GitHubçš„è¿‡ç¨‹
            setTimeout(() => {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    
                    // æ·»åŠ åˆ°ç”¨æˆ·æ–‡ä»¶åˆ—è¡¨
                    if (!users[email].files) {
                        users[email].files = [];
                    }
                    
                    users[email].files.push({
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        uploaded: new Date().toISOString()
                    });
                }
                
                // æ›´æ–°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('cloud_drive_users', JSON.stringify(users));
                
                // é‡æ–°åŠ è½½æ–‡ä»¶åˆ—è¡¨
                loadFiles(email);
                
                alert(`æˆåŠŸä¸Šä¼  ${files.length} ä¸ªæ–‡ä»¶`);
            }, 1500);
        }
        
        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(filename) {
            // åˆ›å»ºè™šæ‹Ÿä¸‹è½½é“¾æ¥
            const element = document.createElement('a');
            const fileContent = `è¿™æ˜¯æ–‡ä»¶ "${filename}" çš„å†…å®¹ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šä»GitHubè·å–çœŸå®æ–‡ä»¶æ•°æ®ã€‚`;
            const file = new Blob([fileContent], {type: 'text/plain'});
            element.href = URL.createObjectURL(file);
            element.download = filename;
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            
            alert(`å¼€å§‹ä¸‹è½½: ${filename}`);
        }
        
        // åˆ é™¤æ–‡ä»¶
        function deleteFile(filename) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤ "${filename}" å—ï¼Ÿ`)) {
                const email = localStorage.getItem('cloud_drive_current_user');
                if (!email) return;
                
                users[email].files = users[email].files.filter(file => file.name !== filename);
                localStorage.setItem('cloud_drive_users', JSON.stringify(users));
                
                loadFiles(email);
                alert(`æ–‡ä»¶ "${filename}" å·²åˆ é™¤`);
            }
        }
        
        // åˆ›å»ºæ–‡ä»¶å¤¹
        function createFolder(folderName) {
            const email = localStorage.getItem('cloud_drive_current_user');
            if (!email) return;
            
            if (!users[email].folders) {
                users[email].folders = [];
            }
            
            // æ£€æŸ¥æ–‡ä»¶å¤¹æ˜¯å¦å·²å­˜åœ¨
            if (users[email].folders.some(folder => folder.name === folderName)) {
                alert('æ–‡ä»¶å¤¹å·²å­˜åœ¨');
                return;
            }
            
            users[email].folders.push({
                name: folderName,
                created: new Date().toISOString()
            });
            
            localStorage.setItem('cloud_drive_users', JSON.stringify(users));
            loadFiles(email);
            alert(`æ–‡ä»¶å¤¹ "${folderName}" åˆ›å»ºæˆåŠŸ`);
        }
        
        // æ‰“å¼€æ–‡ä»¶å¤¹
        function openFolder(folderName) {
            currentPath.push(folderName);
            updateBreadcrumb();
            
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šåŠ è½½æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶
            filesContainer.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--gray);">
                    <div style="font-size: 48px; margin-bottom: 15px;"><i class="fas fa-folder-open"></i></div>
                    <h3>${folderName}</h3>
                    <p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºæ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶</p>
                    <button class="btn btn-primary" onclick="goBack()" style="margin-top: 15px;">è¿”å›ä¸Šçº§ç›®å½•</button>
                </div>
            `;
        }
        
        // åˆ é™¤æ–‡ä»¶å¤¹
        function deleteFolder(folderName) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶å¤¹ "${folderName}" å—ï¼Ÿ`)) {
                const email = localStorage.getItem('cloud_drive_current_user');
                if (!email) return;
                
                users[email].folders = users[email].folders.filter(folder => folder.name !== folderName);
                localStorage.setItem('cloud_drive_users', JSON.stringify(users));
                
                loadFiles(email);
                alert(`æ–‡ä»¶å¤¹ "${folderName}" å·²åˆ é™¤`);
            }
        }
        
        // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
        function updateBreadcrumb() {
            let breadcrumbHTML = '';
            
            // æ ¹ç›®å½•
            breadcrumbHTML += `<div class="breadcrumb-item" onclick="goToRoot()">å…¨éƒ¨æ–‡ä»¶</div>`;
            
            // å½“å‰è·¯å¾„
            currentPath.forEach((folder, index) => {
                breadcrumbHTML += `<div class="breadcrumb-separator">/</div>`;
                if (index === currentPath.length - 1) {
                    breadcrumbHTML += `<div class="breadcrumb-item current-folder">${folder}</div>`;
                } else {
                    breadcrumbHTML += `<div class="breadcrumb-item" onclick="goToFolder(${index})">${folder}</div>`;
                }
            });
            
            breadcrumb.innerHTML = breadcrumbHTML;
            currentFolderTitle.textContent = currentPath.length > 0 ? currentPath[currentPath.length - 1] : 'å…¨éƒ¨æ–‡ä»¶';
        }
        
        // è¿”å›æ ¹ç›®å½•
        function goToRoot() {
            currentPath = [];
            updateBreadcrumb();
            loadFiles(localStorage.getItem('cloud_drive_current_user'));
        }
        
        // è¿”å›ä¸Šçº§ç›®å½•
        function goBack() {
            if (currentPath.length > 0) {
                currentPath.pop();
                updateBreadcrumb();
                loadFiles(localStorage.getItem('cloud_drive_current_user'));
            }
        }
        
        // è·³è½¬åˆ°æŒ‡å®šæ–‡ä»¶å¤¹
        function goToFolder(index) {
            currentPath = currentPath.slice(0, index + 1);
            updateBreadcrumb();
            loadFiles(localStorage.getItem('cloud_drive_current_user'));
        }
        
        // å·¥å…·å‡½æ•°ï¼šè·å–æ–‡ä»¶ç±»å‹å›¾æ ‡
        function getFileIcon(fileType) {
            if (fileType.startsWith('image/')) return 'ğŸ–¼ï¸';
            if (fileType.startsWith('video/')) return 'ğŸ¬';
            if (fileType.startsWith('audio/')) return 'ğŸµ';
            if (fileType.includes('pdf')) return 'ğŸ“„';
            if (fileType.includes('zip') || fileType.includes('rar')) return 'ğŸ“¦';
            if (fileType.includes('word') || fileType.includes('document')) return 'ğŸ“';
            if (fileType.includes('sheet') || fileType.includes('excel')) return 'ğŸ“Š';
            return 'ğŸ“„';
        }
        
        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>